/* sigmajs.org - an open-source light-weight JavaScript graph drawing library - Version: 0.1 - Author: Alexis Jacomy - License: MIT */ var sigma={tools:{},classes:{},instances:{}}; (function(){Array.prototype.some||(Array.prototype.some=function(i,l){var f=this.length;if("function"!=typeof i)throw new TypeError;for(var j=0;j";a+="
LOCAL :

";for(b in c.p.localProbes)a+="
"+b+" : "+c.p.localProbes[b]()+"

";c.p.dom.innerHTML=a;return c}sigma.classes.Cascade.call(this);var c=this;this.instance=b;this.monitoring=!1;this.p={fps:40,dom:v,globalProbes:{"Time (ms)":sigma.chronos.getExecutionTime,Queue:sigma.chronos.getQueuedTasksCount,Tasks:sigma.chronos.getTasksCount, FPS:sigma.chronos.getFPS},localProbes:{"Nodes count":function(){return c.instance.graph.nodes.length},"Edges count":function(){return c.instance.graph.edges.length}}};this.activate=function(){c.monitoring||(c.monitoring=window.setInterval(h,1E3/c.p.fps));return c};this.desactivate=function(){c.monitoring&&(window.clearInterval(c.monitoring),c.monitoring=null,c.p.dom.innerHTML="");return c}}function f(b){function v(d){a.p.mouseEnabled&&(h(a.mouseX,a.mouseY,a.ratio*(0<(void 0!=d.wheelDelta&&d.wheelDelta|| void 0!=d.detail&&-d.detail)?a.p.zoomMultiply:1/a.p.zoomMultiply)),a.p.blockScroll&&(d.preventDefault?d.preventDefault():d.returnValue=!1))}function h(d,b,m){if(!a.isMouseDown&&(window.clearInterval(a.interpolationID),k=void 0!=m,n=a.stageX,y=d,C=a.stageY,t=b,g=m||a.ratio,g=Math.min(Math.max(g,a.p.minRatio),a.p.maxRatio),j=a.p.directZooming?1-(k?a.p.zoomDelta:a.p.dragDelta):0,a.ratio!=g||a.stageX!=y||a.stageY!=t))c(),a.interpolationID=window.setInterval(c,50),a.dispatch("startinterpolate")}function c(){j+= k?a.p.zoomDelta:a.p.dragDelta;j=Math.min(j,1);var d=sigma.easing.quadratic.easeout(j),c=a.ratio;a.ratio=c*(1-d)+g*d;k?(a.stageX=y+(a.stageX-y)*a.ratio/c,a.stageY=t+(a.stageY-t)*a.ratio/c):(a.stageX=n*(1-d)+y*d,a.stageY=C*(1-d)+t*d);a.dispatch("interpolate");1<=j&&(window.clearInterval(a.interpolationID),d=a.ratio,k?(a.ratio=g,a.stageX=y+(a.stageX-y)*a.ratio/d,a.stageY=t+(a.stageY-t)*a.ratio/d):(a.stageX=y,a.stageY=t),a.dispatch("stopinterpolate"))}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this); var a=this;this.p={minRatio:1,maxRatio:32,marginRatio:1,zoomDelta:0.1,dragDelta:0.3,zoomMultiply:2,directZooming:!1,blockScroll:!0,inertia:1.1,mouseEnabled:!0};var o=0,d=0,n=0,C=0,g=1,y=0,t=0,m=0,p=0,f=0,i=0,j=0,k=!1;this.stageY=this.stageX=0;this.ratio=1;this.mouseY=this.mouseX=0;this.isMouseDown=!1;b.addEventListener("DOMMouseScroll",v,!0);b.addEventListener("mousewheel",v,!0);b.addEventListener("mousemove",function(c){a.mouseX=void 0!=c.offsetX&&c.offsetX||void 0!=c.layerX&&c.layerX||void 0!=c.clientX&& c.clientX;a.mouseY=void 0!=c.offsetY&&c.offsetY||void 0!=c.layerY&&c.layerY||void 0!=c.clientY&&c.clientY;if(a.isMouseDown){var b=a.mouseX-o+n,g=a.mouseY-d+C;if(b!=a.stageX||g!=a.stageY)p=m,i=f,m=b,f=g,a.stageX=b,a.stageY=g,a.dispatch("drag")}a.dispatch("move");c.preventDefault?c.preventDefault():c.returnValue=!1},!0);b.addEventListener("mousedown",function(c){a.p.mouseEnabled&&(a.isMouseDown=!0,a.dispatch("mousedown"),n=a.stageX,C=a.stageY,o=a.mouseX,d=a.mouseY,p=m=a.stageX,i=f=a.stageY,a.dispatch("startdrag"), c.preventDefault?c.preventDefault():c.returnValue=!1)},!0);document.addEventListener("mouseup",function(d){a.p.mouseEnabled&&a.isMouseDown&&(a.isMouseDown=!1,a.dispatch("mouseup"),(n!=a.stageX||C!=a.stageY)&&h(a.stageX+a.p.inertia*(a.stageX-p),a.stageY+a.p.inertia*(a.stageY-i)),d.preventDefault?d.preventDefault():d.returnValue=!1)},!0);this.checkBorders=function(){return a};this.interpolate=h}function j(b,v){function h(){sigma.chronos.removeTask("node_"+d.id,2).removeTask("edge_"+d.id,2).removeTask("label_"+ d.id,2).stopTasks();return d}function c(a,c){d.domElements[a]=document.createElement(c);d.domElements[a].style.position="absolute";d.domElements[a].setAttribute("id","sigma_"+a+"_"+d.id);d.domElements[a].setAttribute("class","sigma_"+a+"_"+c);d.domElements[a].setAttribute("width",d.width+"px");d.domElements[a].setAttribute("height",d.height+"px");d.domRoot.appendChild(d.domElements[a]);return d}function a(){d.p.drawHoverNodes&&(d.graph.checkHover(d.mousecaptor.mouseX,d.mousecaptor.mouseY),d.graph.nodes.forEach(function(a){a.hover&& !a.active&&d.plotter.drawHoverNode(a)}));return d}function o(){d.p.drawActiveNodes&&d.graph.nodes.forEach(function(a){a.active&&d.plotter.drawActiveNode(a)});return d}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var d=this;this.id=v.toString();this.p={auto:!0,drawNodes:2,drawEdges:1,drawLabels:2,lastNodes:2,lastEdges:0,lastLabels:2,drawHoverNodes:!0,drawActiveNodes:!0};this.domRoot=b;this.width=this.domRoot.offsetWidth;this.height=this.domRoot.offsetHeight;this.graph= new u;this.domElements={};c("edges","canvas");c("nodes","canvas");c("labels","canvas");c("hover","canvas");c("monitor","div");c("mouse","canvas");this.plotter=new s(this.domElements.nodes.getContext("2d"),this.domElements.edges.getContext("2d"),this.domElements.labels.getContext("2d"),this.domElements.hover.getContext("2d"),this.graph,this.width,this.height);this.monitor=new l(this,this.domElements.monitor);this.mousecaptor=new f(this.domElements.mouse,this.id);this.mousecaptor.bind("drag interpolate", function(){d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?0:d.p.drawEdges,d.p.auto?2:d.p.drawLabels,!0)}).bind("stopdrag stopinterpolate",function(){d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?1:d.p.drawEdges,d.p.auto?2:d.p.drawLabels,!0)}).bind("mousedown mouseup",function(a){var c=d.graph.nodes.filter(function(a){return!!a.hover}).map(function(a){return a.id});d.dispatch("mousedown"==a.type?"downgraph":"upgraph");c.length&&d.dispatch("mousedown"==a.type?"downnodes":"upnodes",c)}).bind("move",function(){d.domElements.hover.getContext("2d").clearRect(0, 0,d.domElements.hover.width,d.domElements.hover.height);a();o()});sigma.chronos.bind("startgenerators",function(){sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+d.id+"$",""))})&&d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?0:d.p.drawEdges,d.p.auto?2:d.p.drawLabels)}).bind("stopgenerators",function(){d.draw()});for(var n=0;n-k/3&&a.displayX-a.displaySize<4*k/3&&a.displayY+a.displaySize>-l/3&&a.displayY-a.displaySize<4*l/3}sigma.classes.Cascade.call(this);var g=this;this.p={labelColor:"default",defaultLabelColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff", labelHoverShadow:!0,labelHoverShadowColor:"#000",labelHoverColor:"default",defaultLabelHoverColor:"#000",labelActiveBGColor:"default",defaultActiveLabelBGColor:"#fff",labelActiveShadow:!0,labelActiveShadowColor:"#000",labelActiveColor:"default",defaultLabelActiveColor:"#000",labelSize:"fixed",defaultLabelSize:12,labelSizeRatio:2,labelThreshold:6,font:"Arial",hoverFont:"",activeFont:"",fontStyle:"",hoverFontStyle:"",activeFontStyle:"",edgeColor:"source",defaultEdgeColor:"#aaa",defaultEdgeType:"line", defaultNodeColor:"#aaa",nodeHoverColor:"node",defaultNodeHoverColor:"#fff",nodeActiveColor:"node",defaultNodeActiveColor:"#fff",borderSize:0,nodeBorderColor:"node",defaultNodeBorderColor:"#fff",edgesSpeed:200,nodesSpeed:200,labelsSpeed:200};var k=i,l=d;this.currentLabelIndex=this.currentNodeIndex=this.currentEdgeIndex=0;this.task_drawLabel=function(){for(var b=a.nodes.length,c=0;c++=g.p.labelThreshold||d.forceLabel){var i="fixed"==g.p.labelSize?g.p.defaultLabelSize:g.p.labelSizeRatio*d.displaySize;f.font=g.p.fontStyle+i+"px "+g.p.font;f.fillStyle="node"==g.p.labelColor?d.color||g.p.defaultNodeColor:g.p.defaultLabelColor;f.fillText(d.label,Math.round(d.displayX+1.5*d.displaySize),Math.round(d.displayY+i/2-3))}}else g.currentLabelIndex++;return g.currentLabelIndex(b*=2)?0.5*b*b:-0.5*(--b*(b-2)-1)};sigma.publicPrototype=k.prototype})();
